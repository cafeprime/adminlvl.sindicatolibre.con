$(function () {

    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });
    
    $("#usuario").on("focus", function () {
        $("#usuario").removeClass("is-invalid");
        $('.sign-login').addClass("ocultar");
    });
    $("#password").on("focus", function () {
        $("#password").removeClass("is-invalid");
        $('.sign-login').addClass("ocultar");
    });

    $('#btn_acceso').on('click', function () {

        if ($('#usuario').val().trim() == "") {
            $("#usuario").attr('placeholder', 'Introduzca usuario');
            $("#usuario").addClass("is-invalid");
        }

        if ($('#password').val().trim() == "") {
            $("#password").attr('placeholder', 'Introduzca contraseña');
            $("#password").addClass("is-invalid");
        } 

        if ($('#usuario').val().trim() == "" || $('#password').val().trim() == "") {
            return false;
        }

        $(this).attr('disabled', 'disabled').html('Comprobando...');
        
        $.ajax({
            type: "POST",
            url: "ajaxlogin",
            data: $('#login-form').serialize(),
            success: function (response) {
                if (response == "ok") {
                    $('#btn_acceso').attr('disabled', 'disabled').html('Accediendo...');
                    $(location).attr('href', 'registros-listar');
                }else if(response == "desac"){
                    $(location).attr('href', "/");
                }
                else {
                    $('.basealert').html("<i class='mdi mdi-block-helper mr-2'></i> Usuario o contraseña incorrectos.").removeClass("ocultar");
                    $('#btn_acceso').removeAttr('disabled').html('Acceder');
                }
            }
        });

    });
    
});
